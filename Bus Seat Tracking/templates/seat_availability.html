<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-seat Tracker - Seat Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        /* General Styling */
        body { background-color: #f9fafc; color: #001f3f; font-family: Arial, sans-serif; }
        .navbar { background-color: white; padding: 1rem 2rem; border-bottom: 1px solid #eaeaea; }
        .navbar-brand { font-weight: bold; color: #001f3f !important; }
        .nav-link { color: #001f3f !important; margin: 0 1rem; font-weight: 500; }
        .nav-link.active { background-color: #ffc107; border-radius: 0.5rem; padding: 0.5rem 1rem; }
        .seat-monitoring { padding: 3rem 1rem; text-align: left; }
        .seat-monitoring h1 { text-align: center; font-weight: bold; color: #001f3f; }
        .seat-grid { display: grid; grid-template-columns: repeat(3, 100px); gap: 1rem; margin-top: 1.5rem; justify-content: center; }
        .seat { font-weight: bold; color: white; padding: 1rem; border-radius: 8px; text-align: center; font-size: 1rem; }
        .occupied { background-color: #ff4d4d; }
        .child { background-color: #ff8c1a; }
        .luggage { background-color: #ffd700; }
        .available { background-color: #4caf50; }
        .passenger-count { margin-top: 1.5rem; font-size: 2rem; font-weight: bold; color: #001f3f; text-align: center; }
        .legend { display: flex; align-items: center; gap: 2rem; margin-top: 2rem; justify-content: center; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; }
        .legend-box { width: 20px; height: 20px; border-radius: 4px; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
		<img src="/static/logo.png" alt="Logo" style="width: 150px; height: 75px;">
        <a class="navbar-brand" href="/">E-seat Tracker</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                <li class="nav-item"><a class="nav-link active" href="/seat_availability">Seat Monitoring</a></li>
                <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Seat Monitoring Section -->
    <div class="seat-monitoring container">
        <h1>SEAT MONITORING</h1>

        <!-- Seat Grid -->
        <div class="seat-grid" id="seatGrid">
            {% for seat, data in seats.items() %}
                <div id="{{ seat }}" 
                     class="seat {% if data.status == 'Kursi Terisi' %}occupied{% elif data.classification == 'Terdapat Balita' %}child{% elif data.classification == 'Terdapat Barang' %}luggage{% else %}available{% endif %}">
                    Seat {{ loop.index }}
                </div>
            {% endfor %}
        </div>

        <!-- Passenger Count -->
        <div class="passenger-count" id="passengerCount">{{ passenger_count }} Passengers on The Bus</div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item"><div class="legend-box occupied"></div> Terisi</div>
            <div class="legend-item"><div class="legend-box child"></div> Terisi Balita</div>
            <div class="legend-item"><div class="legend-box luggage"></div> Terisi Barang</div>
            <div class="legend-item"><div class="legend-box available"></div> Kosong</div>
        </div>
    </div>

    <!-- Socket.IO Script -->
    <script>
        const socket = io();

        socket.on('connect', function () {
            console.log('Connected to Socket.IO server');
        });

        // Listen for update_data event
        socket.on('update_data', function (data) {
            console.log("Received update_data:", data);

            const seatData = data.seats;
            const passengerCount = data.passenger_count;

            // Update each seat's status and classification
            for (const [seatId, seatInfo] of Object.entries(seatData)) {
                const seatElement = document.getElementById(seatId);
                if (seatElement) {
                    seatElement.className = 'seat';  // Reset classes
                    seatElement.classList.add(
                        seatInfo.status === 'Kursi Terisi' ? 'occupied' :
                        seatInfo.classification === 'Terdapat Balita' ? 'child' :
                        seatInfo.classification === 'Terdapat Barang' ? 'luggage' : 'available'
                    );
                }
            }

            // Update passenger count
            document.getElementById('passengerCount').innerText = `${passengerCount} Passengers on The Bus`;
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
