<!-- templates/seat_availability.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-seat Tracker - Seat Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        /* Styling for seats, navbar, and layout */
        body { background-color: #f9fafc; color: #001f3f; font-family: Arial, sans-serif; }
        .navbar { background-color: white; padding: 0.8rem 1.5rem; border-bottom: 1px solid #eaeaea; }
        .navbar-brand img { width: 40px; margin-right: 0.5rem; }
        .seat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.8rem; margin-top: 1rem; }
        .seat { padding: 0.8rem; border-radius: 8px; font-weight: bold; color: white; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); }
        .occupied { background-color: #ff4d4d; }
        .child { background-color: #ff8c1a; }
        .luggage { background-color: #ffd700; }
        .available { background-color: #4caf50; }
        .passenger-count { font-size: 1.5rem; font-weight: bold; margin-top: 1.2rem; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="/">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="E-seat Logo"> E-seat Tracker
        </a>
    </nav>

    <!-- Seat Monitoring Section -->
    <div class="seat-monitoring container">
        <h1>Seat Monitoring</h1>
        <div class="seat-grid" id="seatGrid">
            {% for seat, data in seats.items() %}
                <div id="{{ seat }}" 
                     class="seat {% if data.status == 'Kursi Terisi' %}occupied{% elif data.classification == 'Terdapat Balita' %}child{% elif data.classification == 'Terdapat Barang' %}luggage{% else %}available{% endif %}">
                    Seat {{ loop.index }}
                </div>
            {% endfor %}
        </div>
        <div class="passenger-count" id="passengerCount">{{ passenger_count }} Passengers on The Bus</div>
    </div>

    <!-- Socket.IO Script -->
    <script>
        const socket = io();

        socket.on('connect', function () {
            console.log('Connected to Socket.IO server');
        });

        socket.on('update_data', function (data) {
            console.log("Received update_data:", data);

            const seatData = data.seats;
            const passengerCount = data.passenger_count;

            // Update each seat's status and classification
            for (const [seatId, seatInfo] of Object.entries(seatData)) {
                const seatElement = document.getElementById(seatId);
                if (seatElement) {
                    seatElement.classList.remove('occupied', 'child', 'luggage', 'available');
                    seatElement.classList.add(
                        seatInfo.status === 'Kursi Terisi' ? 'occupied' :
                        seatInfo.classification === 'Terdapat Balita' ? 'child' :
                        seatInfo.classification === 'Terdapat Barang' ? 'luggage' : 'available'
                    );
                }
            }

            // Update passenger count
            document.getElementById('passengerCount').innerText = `${passengerCount} Passengers on The Bus`;
        });
    </script>
</body>
</html>
